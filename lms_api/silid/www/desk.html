<!DOCTYPE html>
<head>
	<!-- Chrome, Firefox OS and Opera -->
	<meta name="theme-color" content="#7575ff">
	<!-- Windows Phone -->
	<meta name="msapplication-navbutton-color" content="#7575ff">
	<!-- iOS Safari -->
	<meta name="apple-mobile-web-app-status-bar-style" content="#7575ff">	<meta charset="utf-8">
	<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
	<meta content="utf-8" http-equiv="encoding">
	<meta name="author" content="">
	<meta name="viewport" content="width=device-width, initial-scale=1.0,
		maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, minimal-ui">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="white">
	<meta name="mobile-web-app-capable" content="yes">
	<title>Frappe Desk</title>
	<link rel="shortcutss icon"
		href="{{ favicon or "/assets/frappe/images/favicon.png" }}" type="image/x-icon">
	<link rel="icon"
		href="{{ favicon or "/assets/frappe/images/favicon.png" }}" type="image/x-icon">
	{% for include in include_css -%}
	<link type="text/css" rel="stylesheet" href="{{ include }}?ver={{ build_version }}">
	{%- endfor -%}
</head>
<body>

	<div class="centered splash" style="width: 100px; height: 100px;">
        <img src="{{ splash_image or "/assets/frappe/images/frappe-framework-logo.png" }}">
    </div>
	<div class="main-section">

		<header>

		</header>
		<span class="notification-reminder notification-red" id="notification-denied">You have not enabled notifications. Enable it through your browser settings</span>
		<span class="notification-reminder notification-yellow" id="notification-default">Do you want to enable notifications?
			<button class="btn" id="askNotificationPermission" onclick="askNotificationPermission()">Enable</button>
		</span>

		<div id="body_div"></div>
		<footer></footer>
	</div>
	{% if background_image %}
	<div class="dashboard-image" style="background-image: url('{{ background_image }}');background-repeat: no-repeat;background-size: cover;background-position: center;height:100vh"></div>
	{% endif %}
	<script type="text/javascript" src="/assets/frappe/js/lib/jquery/jquery.min.js"></script>
	<script type="text/javascript" src="/assets/lms_api/js/howler.js"></script>
	<script type="text/javascript" src="/assets/lms_api/js/notification_service.js"></script>

	<script type="text/javascript">
	window._version_number = "{{ build_version }}";
	// browser support
	window.app = true;
	window.dev_server = {{ dev_server }};

	if(!window.frappe) window.frappe = {};

	frappe.boot = {{ boot }};

	frappe.csrf_token = "{{ csrf_token }}";

	</script>

	<script type="text/javascript">

		let askNotificationPermission = function() {
			askPermission();
			$("#notification-default").hide();
			console.log("Asked Notification Permission");
		};

		window.onload = function() {
		  	let current_route = window.location.href.split('/').pop();
		  	if (current_route === "desk#" || current_route === "desk") {
		  		$(".dashboard-image").show();

		  		if (("Notification" in window)) {
					if (notificationPermission() === "granted") {
		  			$(".notification-reminder").hide();
					}
					if (notificationPermission() === "denied") {
						$("#notification-denied").show();
						$("#notification-default").hide();

					}
					if (notificationPermission() === "default"){
						$("#notification-default").show();
						$("#notification-denied").hide();
						askPermission();
					}
				}
		  	} else {
				$(".dashboard-image").hide();
				$(".notification-reminder").hide();
		  	}
		};
		window.addEventListener('popstate', function (event) {
			let current_route = window.location.href.split('/').pop();
		  	if (current_route === "desk#" || current_route === "desk") {
		  		$(".dashboard-image").show();

		  		if (("Notification" in window)) {
					if (notificationPermission() === "granted") {
		  			$(".notification-reminder").hide();
					}
					if (notificationPermission() === "denied") {
						$("#notification-denied").show();
						$("#notification-default").hide();

					}
					if (notificationPermission() === "default"){
						$("#notification-default").show();
						$("#notification-denied").hide();
						askPermission();
					}
				}
		  	} else {
				$(".dashboard-image").hide();
				$(".notification-reminder").hide();
		  	}
		});
	</script>

	{% for include in include_js %}
	<script type="text/javascript" src="{{ include }}?ver={{ build_version }}"></script>
	{% endfor %}
    {% include "templates/includes/app_analytics/google_analytics.html" %}
    {% include "templates/includes/app_analytics/mixpanel_analytics.html" %}

	{% for sound in (sounds or []) %}
	<audio preload="auto" id="sound-{{ sound.name }}" volume={{ sound.volume or 1 }}>
		<source src="{{ sound.src }}"></source>
	</audio>
	{% endfor %}
</body>
